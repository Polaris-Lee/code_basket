#redis性能瓶颈

####
一般情况redis用作缓存不会是项目的瓶颈点，本次讨论短时间内多次读写redis而拖慢性能情况。

####
物联网行业通常一个项目有很多网关、设备、测点。在向前端推送实时数据时为了不堵塞收集器任务而将数据推到redis同时通知到websocket服务,
websocket 获取到通知之后将数据从redis取出送到前端。这个过程进行了多次redis读写，数据大的时候将达到一秒几万条指令，单独执行每条指令将耗费大量时间，
同时redis压力剧增将无法保证数据及时写入。

对于以上情况分为两个阶段解决：


    1. 大量数据写入redis,写入过程通常是很小的数据量，而写入次数相当多。主要时间耗费到与redis连接和大量命令执行。
    对于连接造成的瓶颈可以采用连接池方法来避免多次连接，而大量写入命令则可以用redis的pipeline进行一次性写入。 
    
    2.大量数据读取。通常redis的读取非常快，但是当数据量特别大的时候将造成压力，使任务阻塞在执行读取命令，这种情况下要考虑使用内存缓存一次，
    这种热数据在内存和redis中都进行缓存，redis做持久化存储。构建map类型数据，先检查map中是否存在对应数据，没有再向redis请求。每次数据变化时
    对map数据进行一次更新。


注意：

    1.这种做法会导致进程间数据不同步！一般要设置内存内存储的超时时间。
    2.不要每次redis更新操作都新启协程或线程来解决，一般使用worker来接受数据进行处理。
