# 关于tornado数据库的讨论

#### 问题关键点
是否是需要用tornado搭配sqlalchemy进行进行数据库的操作

#### 可用解决方案
1. tornado搭配sqlalchemy使用Celery、run_on_executor
2. 数据库操作由其他服务实现对外暴露接口，tornado通过socket等对接口进行调用实现数据库异步操作
3. 尽量优化sql使数据库操作不是性能瓶颈


#### 矛盾点
tornado是通过epoll实现的异步非阻塞高并发web框架，而sqlalchemy的数据库操作是同步，如果数据库操作慢时会阻塞。

#### 讨论
根据上面的矛盾点可以得出两个解决方案
1.想办法将sqlalchemy操作异步尽可能在别的线程上进行操作
2.将数据库操作部分分离出来交给其他进程解决
对于1方案参考：https://www.jianshu.com/p/9eb901ad735b
由上边文章的做法可以实现，但是过程繁琐同时由于python的GIL这把超级大锁，多线程指不定出什么篓子，个人不推荐使用

对于方案2可以很灵活实现，通过其他进程进行数据库操作，tornado异步调用这个进程暴露出来的接口可以完美避过数据库的问题
不过对于方案2需要满足高并发可扩展的特性尽量可以媲美python开发速度，这里推荐php和golang，php可以通过负载均衡的方式实现
无状态服务端的高并发同时支持实时更新，golang本身就是为高并发而生同时因为是编译型语言会比动态语言计算上快上一个量级。

如果对并发量没有特别高的要求或者数据库操作不是瓶颈的话还是可以使用tornado搭配sqlalchemy尽量优化sql

#### 个人倾向
对并发要求高或者要完全发挥tornado框架性能的业务数据库操作由其他服务实现，tornado异步调用接口
对于并发要求没那么高或者数据库操作不是瓶颈时使用sqlalchemy尽量优化sql
不推荐用python多线程方式实现数据库操作异步